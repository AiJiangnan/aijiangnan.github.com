# 常用对象之视图

## 一、视图的概念

**1. 定义**

- 视图是从若干基本表和（或）其他视图构造出来的表
- 在创建一个视图时，只是存放的视图的定义，也即是动态检索数据的查询语句，而并不存放视图对应的数据
- 在用户使用视图时才去求相对应的数据。所以视图被称作“虚表”

**2. 作用**

- 可以限制对数据的访问，可以给用户授予表的特定部分的访问权限而不是整个表的访问权限
- 可以使复杂的查询变的简单。在编写查询后，可以方便地重用它而不必知道他的基本查询细节
- 提供了对相同数据的不同显示

## 二、视图的操作

**1. 操作视图**

```sql
-- 创建（或替换）视图
CREATE OR REPLACE VIEW view_emp AS (SELECT * FROM emp);
-- 查询视图
SELECT * FROM view_emp;
-- 删除视图
DROP VIEW view_emp;
```

注意：创建（或替换）视图视图需要DBA权限。因为视图可以看作是一张表，所以一些操作都与表操作一样。

**2. 操作视图中的数据**

```sql
-- 查询
SELECT * FROM view_emp;
-- 插入
INSERT INTO view_emp VALUES (1111,'AiJiangnan','King',1234,SYSDATE,10000,10000,10);
-- 更新
UPDATE view_emp SET mgr=2222 WHERE empno=1111;
-- 删除
DELETE FROM view_emp WHERE empno=1111;
```

说明：操作视图中的数据可以和操作表中的数据一样。

## 三、视图的作用

**1. 视图可以隐藏表格的部分数据**

```sql
CREATE OR REPLACE VIEW view_emp AS (SELECT empno,ename,job,mgr FROM emp);
SELECT * FROM view_emp;
```

说明：此时的视图已经更改为只显示部分信息，对视图的操作也只会更改表中的部分信息。

**2. 将复杂的查询简单化**

```sql
CREATE OR REPLACE VIEW view_dept AS (
	SELECT d.*,COUNT(e.empno) cnt,AVG(e.sal) avg_sal
	FROM emp e,dept d
	WHERE e.deptno(+)=d.deptno
	GROUP BY d.deptno,d.dname,d.loc
);

SELECT * FROM view_dept ORDER BY deptno;
```

说明：将复杂的查询创建为视图，以后执行查询的时候只需对视图进行查询即可，复杂的查询只需编写一次。注意，多表连接的视图只能进行DQL查询操作，不能进行DML操作，相当于一张只读的表。

